!-- ═══════════════════════════════════════════════════════════════════════════
     FRONTEND_SCRIPTS_MAIN.HTML
     JavaScript principal del sistema QA Management
     ═══════════════════════════════════════════════════════════════════════════ -->

<script>
// ─────────────────────────────────────────────────────────────────────────── 
// FUNCIONES DE SPINNER Y LOADING
// ─────────────────────────────────────────────────────────────────────────── 

function mostrarSpinner() {
  const overlay = document.getElementById('loadingOverlay');
  if (overlay) {
    overlay.classList.add('active');
    
    // Mensajes aleatorios de carga
    const mensajes = [
      'Preparando tu arsenal de testing...',
      'Cargando casos de prueba...',
      'Sincronizando con el servidor...',
      'Configurando workspace...',
      'Casi listo...',
      'Verificando permisos...',
      'Conectando con Google Sheets...'
    ];
    
    const tips = [
      '💡 Tip: Organiza tus casos por módulos',
      '💡 Tip: Usa etiquetas descriptivas en tus bugs',
      '💡 Tip: Los casos críticos van primero',
      '💡 Tip: Documenta los pasos claramente',
      '💡 Tip: Adjunta evidencias a tus ejecuciones'
    ];
    
    const mensajeAleatorio = mensajes[Math.floor(Math.random() * mensajes.length)];
    const tipAleatorio = tips[Math.floor(Math.random() * tips.length)];
    
    const loadingMessage = document.getElementById('loadingMessage');
    const loadingTip = document.getElementById('loadingTip');
    
    if (loadingMessage) loadingMessage.textContent = mensajeAleatorio;
    if (loadingTip) loadingTip.textContent = tipAleatorio;
  }
}

function ocultarSpinner() {
  const overlay = document.getElementById('loadingOverlay');
  if (overlay) {
    overlay.classList.remove('active');
  }
}

// ─────────────────────────────────────────────────────────────────────────── 
// FUNCIONES DE NOTIFICACIONES
// ─────────────────────────────────────────────────────────────────────────── 

function mostrarToast(mensaje, tipo = 'success', duracion = 3000) {
  const notification = document.getElementById('notification');
  const icon = document.getElementById('notificationIcon');
  const messageEl = document.getElementById('notificationMessage');
  
  if (!notification) return;
  
  // Configurar icono según tipo
  const iconos = {
    'success': '✓',
    'error': '✕',
    'warning': '⚠️',
    'info': 'ℹ️'
  };
  
  // Aplicar estilos según tipo
  notification.className = 'notification show ' + tipo;
  icon.textContent = iconos[tipo] || '✓';
  messageEl.textContent = mensaje;
  
  // Mostrar notificación
  setTimeout(() => {
    notification.classList.add('show');
  }, 100);
  
  // Ocultar después de la duración
  setTimeout(() => {
    notification.classList.remove('show');
  }, duracion);
}

// ─────────────────────────────────────────────────────────────────────────── 
// FUNCIONES DE MODALES
// ─────────────────────────────────────────────────────────────────────────── 

function abrirModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
  }
}

function cerrarModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.classList.remove('active');
    document.body.style.overflow = 'auto';
  }
}

// Cerrar modal al hacer click fuera
document.addEventListener('click', function(e) {
  if (e.target.classList && e.target.classList.contains('modal-overlay')) {
    const modalId = e.target.id;
    if (modalId) {
      cerrarModal(modalId);
    }
  }
});

// ─────────────────────────────────────────────────────────────────────────── 
// FUNCIONES DE UTILIDAD
// ─────────────────────────────────────────────────────────────────────────── 

function getBadgePrioridad(prioridad) {
  const badges = {
    'Critica': 'badge-danger',
    'Alta': 'badge-warning', 
    'Media': 'badge-info',
    'Baja': 'badge-success'
  };
  return badges[prioridad] || 'badge-primary';
}

function getBadgeEstado(estado) {
  const badges = {
    'OK': 'badge-success',
    'No_OK': 'badge-danger',
    'Pendiente': 'badge-warning',
    'En diseño': 'badge-info',
    'En diseno': 'badge-info',
    'Ejecutando': 'badge-primary'
  };
  return badges[estado] || 'badge-primary';
}

function formatearFecha(fecha) {
  if (!fecha) return '-';
  const date = typeof fecha === 'string' ? new Date(fecha) : fecha;
  return date.toLocaleDateString('es-ES');
}

// ─────────────────────────────────────────────────────────────────────────── 
// MANEJO DE ERRORES GLOBAL
// ─────────────────────────────────────────────────────────────────────────── 

window.onerror = function(msg, url, lineNo, columnNo, error) {
  console.error('Error global:', msg, 'en línea:', lineNo);
  return false;
};

// ─────────────────────────────────────────────────────────────────────────── 
// FUNCIONES DE DEPURACIÓN
// ─────────────────────────────────────────────────────────────────────────── 

function debugLog(mensaje, datos) {
  console.log(`[DEBUG] ${mensaje}`, datos || '');
}

// Verificar que las funciones críticas estén disponibles
window.addEventListener('DOMContentLoaded', function() {
  debugLog('DOM cargado completamente');
  
  // Verificar funciones críticas
  const funcionesCriticas = [
    'mostrarSpinner',
    'ocultarSpinner',
    'mostrarToast',
    'abrirModal',
    'cerrarModal'
  ];
  
  funcionesCriticas.forEach(func => {
    if (typeof window[func] === 'function') {
      debugLog(`✅ Función ${func} disponible`);
    } else {
      console.error(`❌ Función ${func} NO disponible`);
    }
  });
});

// ─────────────────────────────────────────────────────────────────────────── 
// INICIALIZACIÓN SEGURA
// ─────────────────────────────────────────────────────────────────────────── 

// Asegurar que las funciones estén disponibles globalmente
window.mostrarSpinner = mostrarSpinner;
window.ocultarSpinner = ocultarSpinner;
window.mostrarToast = mostrarToast;
window.abrirModal = abrirModal;
window.cerrarModal = cerrarModal;
window.getBadgePrioridad = getBadgePrioridad;
window.getBadgeEstado = getBadgeEstado;
window.formatearFecha = formatearFecha;

console.log('✅ Frontend Scripts Main cargado correctamente');
</script>
